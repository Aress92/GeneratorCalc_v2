"""Add optimization and regenerator tables

Revision ID: 4db3e43a40d2
Revises: 002_add_default_users
Create Date: 2025-09-25 15:33:56.893966

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import mysql

# revision identifiers, used by Alembic.
revision: str = '4db3e43a40d2'
down_revision: Union[str, None] = '002_add_default_users'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade database schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('configuration_constraints',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('constraint_type', sa.String(length=50), nullable=False),
    sa.Column('regenerator_type', sa.String(length=50), nullable=True),
    sa.Column('constraint_config', sa.JSON(), nullable=False),
    sa.Column('severity', sa.String(length=20), nullable=False),
    sa.Column('rule_expression', sa.Text(), nullable=True),
    sa.Column('validation_function', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('system_metrics',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('metric_name', sa.String(length=100), nullable=False),
    sa.Column('metric_category', sa.String(length=50), nullable=False),
    sa.Column('metric_value', sa.Float(), nullable=False),
    sa.Column('metric_unit', sa.String(length=20), nullable=True),
    sa.Column('dimensions', sa.JSON(), nullable=True),
    sa.Column('measured_at', sa.DateTime(), nullable=False),
    sa.Column('period_start', sa.DateTime(), nullable=True),
    sa.Column('period_end', sa.DateTime(), nullable=True),
    sa.Column('aggregation_type', sa.String(length=20), nullable=True),
    sa.Column('sample_count', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    mysql_engine='InnoDB'
    )
    op.create_table('unit_conversions',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('from_unit', sa.String(length=50), nullable=False),
    sa.Column('to_unit', sa.String(length=50), nullable=False),
    sa.Column('conversion_factor', sa.Float(), nullable=False),
    sa.Column('conversion_offset', sa.Float(), nullable=True),
    sa.Column('unit_type', sa.String(length=50), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('validation_rules',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('import_type', sa.String(length=50), nullable=False),
    sa.Column('field_name', sa.String(length=100), nullable=False),
    sa.Column('rule_type', sa.String(length=50), nullable=False),
    sa.Column('rule_config', sa.JSON(), nullable=False),
    sa.Column('severity', sa.String(length=20), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('configuration_templates',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('regenerator_type', sa.String(length=50), nullable=False),
    sa.Column('category', sa.String(length=100), nullable=True),
    sa.Column('template_config', sa.JSON(), nullable=False),
    sa.Column('default_values', sa.JSON(), nullable=True),
    sa.Column('required_fields', sa.JSON(), nullable=True),
    sa.Column('usage_count', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('is_public', sa.Boolean(), nullable=True),
    sa.Column('created_by_user_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('import_jobs',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('user_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('filename', sa.String(length=255), nullable=False),
    sa.Column('original_filename', sa.String(length=255), nullable=False),
    sa.Column('file_size', sa.Integer(), nullable=False),
    sa.Column('import_type', sa.String(length=50), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('total_rows', sa.Integer(), nullable=True),
    sa.Column('processed_rows', sa.Integer(), nullable=True),
    sa.Column('valid_rows', sa.Integer(), nullable=True),
    sa.Column('invalid_rows', sa.Integer(), nullable=True),
    sa.Column('validation_errors', sa.JSON(), nullable=True),
    sa.Column('validation_warnings', sa.JSON(), nullable=True),
    sa.Column('column_mapping', sa.JSON(), nullable=True),
    sa.Column('metadata_info', sa.JSON(), nullable=True),
    sa.Column('processing_options', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('started_at', sa.DateTime(), nullable=True),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('error_details', sa.JSON(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('materials',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('manufacturer', sa.String(length=255), nullable=True),
    sa.Column('material_code', sa.String(length=100), nullable=True),
    sa.Column('material_type', sa.String(length=50), nullable=False),
    sa.Column('category', sa.String(length=100), nullable=True),
    sa.Column('application', sa.String(length=100), nullable=True),
    sa.Column('properties', sa.JSON(), nullable=False),
    sa.Column('density', sa.Float(), nullable=True),
    sa.Column('thermal_conductivity', sa.Float(), nullable=True),
    sa.Column('specific_heat', sa.Float(), nullable=True),
    sa.Column('max_temperature', sa.Float(), nullable=True),
    sa.Column('porosity', sa.Float(), nullable=True),
    sa.Column('surface_area', sa.Float(), nullable=True),
    sa.Column('chemical_composition', sa.JSON(), nullable=True),
    sa.Column('cost_per_unit', sa.Float(), nullable=True),
    sa.Column('cost_unit', sa.String(length=20), nullable=True),
    sa.Column('availability', sa.String(length=50), nullable=True),
    sa.Column('version', sa.String(length=20), nullable=True),
    sa.Column('superseded_by_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('approval_status', sa.String(length=20), nullable=True),
    sa.Column('approved_by_user_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('approved_at', sa.DateTime(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('is_standard', sa.Boolean(), nullable=True),
    sa.Column('created_by_user_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['approved_by_user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['created_by_user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['superseded_by_id'], ['materials.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_table('optimization_templates',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('template_type', sa.String(length=50), nullable=False),
    sa.Column('regenerator_type', sa.String(length=50), nullable=True),
    sa.Column('template_config', sa.JSON(), nullable=False),
    sa.Column('default_parameters', sa.JSON(), nullable=True),
    sa.Column('usage_count', sa.Integer(), nullable=True),
    sa.Column('success_rate', sa.Float(), nullable=True),
    sa.Column('average_improvement', sa.Float(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('is_public', sa.Boolean(), nullable=True),
    sa.Column('is_verified', sa.Boolean(), nullable=True),
    sa.Column('created_by_user_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('report_templates',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('created_by_user_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('category', sa.String(length=100), nullable=True),
    sa.Column('template_config', sa.JSON(), nullable=False),
    sa.Column('default_filters', sa.JSON(), nullable=True),
    sa.Column('usage_count', sa.Integer(), nullable=True),
    sa.Column('rating_average', sa.Float(), nullable=True),
    sa.Column('rating_count', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('is_public', sa.Boolean(), nullable=True),
    sa.Column('is_system', sa.Boolean(), nullable=True),
    sa.Column('version', sa.String(length=20), nullable=True),
    sa.Column('parent_template_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['parent_template_id'], ['report_templates.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('reports',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('user_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('report_type', sa.String(length=50), nullable=False),
    sa.Column('report_config', sa.JSON(), nullable=False),
    sa.Column('date_range', sa.JSON(), nullable=True),
    sa.Column('filters', sa.JSON(), nullable=True),
    sa.Column('format', sa.String(length=20), nullable=False),
    sa.Column('frequency', sa.String(length=20), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('progress_percentage', sa.Float(), nullable=True),
    sa.Column('generated_at', sa.DateTime(), nullable=True),
    sa.Column('generation_time_seconds', sa.Float(), nullable=True),
    sa.Column('file_size_bytes', sa.Integer(), nullable=True),
    sa.Column('file_path', sa.String(length=500), nullable=True),
    sa.Column('download_url', sa.String(length=500), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('error_traceback', sa.Text(), nullable=True),
    sa.Column('is_scheduled', sa.Boolean(), nullable=True),
    sa.Column('next_generation_at', sa.DateTime(), nullable=True),
    sa.Column('last_generation_at', sa.DateTime(), nullable=True),
    sa.Column('is_public', sa.Boolean(), nullable=True),
    sa.Column('shared_with_users', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('imported_regenerators',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('import_job_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('regenerator_type', sa.String(length=50), nullable=False),
    sa.Column('length', sa.Float(), nullable=False),
    sa.Column('width', sa.Float(), nullable=False),
    sa.Column('height', sa.Float(), nullable=False),
    sa.Column('volume', sa.Float(), nullable=True),
    sa.Column('design_temperature', sa.Float(), nullable=False),
    sa.Column('max_temperature', sa.Float(), nullable=False),
    sa.Column('working_pressure', sa.Float(), nullable=True),
    sa.Column('air_flow_rate', sa.Float(), nullable=True),
    sa.Column('gas_flow_rate', sa.Float(), nullable=True),
    sa.Column('pressure_drop', sa.Float(), nullable=True),
    sa.Column('checker_material', sa.String(length=255), nullable=True),
    sa.Column('insulation_material', sa.String(length=255), nullable=True),
    sa.Column('refractory_material', sa.String(length=255), nullable=True),
    sa.Column('thermal_efficiency', sa.Float(), nullable=True),
    sa.Column('heat_recovery_rate', sa.Float(), nullable=True),
    sa.Column('fuel_consumption', sa.Float(), nullable=True),
    sa.Column('is_validated', sa.Boolean(), nullable=True),
    sa.Column('validation_score', sa.Float(), nullable=True),
    sa.Column('validation_notes', sa.Text(), nullable=True),
    sa.Column('raw_data', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['import_job_id'], ['import_jobs.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('regenerator_configurations',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('user_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('regenerator_type', sa.String(length=50), nullable=False),
    sa.Column('configuration_version', sa.String(length=20), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('current_step', sa.Integer(), nullable=True),
    sa.Column('total_steps', sa.Integer(), nullable=True),
    sa.Column('completed_steps', sa.JSON(), nullable=True),
    sa.Column('geometry_config', sa.JSON(), nullable=True),
    sa.Column('materials_config', sa.JSON(), nullable=True),
    sa.Column('thermal_config', sa.JSON(), nullable=True),
    sa.Column('flow_config', sa.JSON(), nullable=True),
    sa.Column('constraints_config', sa.JSON(), nullable=True),
    sa.Column('visualization_config', sa.JSON(), nullable=True),
    sa.Column('model_geometry', sa.JSON(), nullable=True),
    sa.Column('model_materials', sa.JSON(), nullable=True),
    sa.Column('is_validated', sa.Boolean(), nullable=True),
    sa.Column('validation_score', sa.Float(), nullable=True),
    sa.Column('validation_errors', sa.JSON(), nullable=True),
    sa.Column('validation_warnings', sa.JSON(), nullable=True),
    sa.Column('based_on_template_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('is_template', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['based_on_template_id'], ['configuration_templates.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('report_data',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('report_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('section_name', sa.String(length=100), nullable=False),
    sa.Column('section_order', sa.Integer(), nullable=False),
    sa.Column('raw_data', sa.JSON(), nullable=False),
    sa.Column('aggregated_data', sa.JSON(), nullable=True),
    sa.Column('chart_config', sa.JSON(), nullable=True),
    sa.Column('chart_data', sa.JSON(), nullable=True),
    sa.Column('data_source', sa.String(length=100), nullable=True),
    sa.Column('calculation_method', sa.String(length=100), nullable=True),
    sa.Column('data_completeness', sa.Float(), nullable=True),
    sa.Column('data_freshness_hours', sa.Float(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['report_id'], ['reports.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('report_exports',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('report_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('user_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('export_format', sa.String(length=20), nullable=False),
    sa.Column('file_name', sa.String(length=255), nullable=False),
    sa.Column('file_path', sa.String(length=500), nullable=False),
    sa.Column('file_size_bytes', sa.Integer(), nullable=False),
    sa.Column('export_config', sa.JSON(), nullable=True),
    sa.Column('generation_time_seconds', sa.Float(), nullable=True),
    sa.Column('download_count', sa.Integer(), nullable=True),
    sa.Column('last_downloaded_at', sa.DateTime(), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.Column('is_available', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['report_id'], ['reports.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('report_schedules',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('user_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('template_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('frequency', sa.String(length=20), nullable=False),
    sa.Column('cron_expression', sa.String(length=100), nullable=True),
    sa.Column('timezone', sa.String(length=50), nullable=True),
    sa.Column('report_config', sa.JSON(), nullable=False),
    sa.Column('email_recipients', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('last_run_at', sa.DateTime(), nullable=True),
    sa.Column('next_run_at', sa.DateTime(), nullable=True),
    sa.Column('last_success_at', sa.DateTime(), nullable=True),
    sa.Column('failure_count', sa.Integer(), nullable=True),
    sa.Column('max_failures', sa.Integer(), nullable=True),
    sa.Column('retention_days', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['template_id'], ['report_templates.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('configuration_history',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('configuration_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('user_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('action', sa.String(length=50), nullable=False),
    sa.Column('step_name', sa.String(length=100), nullable=True),
    sa.Column('changes', sa.JSON(), nullable=True),
    sa.Column('old_values', sa.JSON(), nullable=True),
    sa.Column('new_values', sa.JSON(), nullable=True),
    sa.Column('session_id', sa.String(length=255), nullable=True),
    sa.Column('ip_address', sa.String(length=45), nullable=True),
    sa.Column('user_agent', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['configuration_id'], ['regenerator_configurations.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('geometry_components',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('configuration_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('component_name', sa.String(length=255), nullable=False),
    sa.Column('component_type', sa.String(length=50), nullable=False),
    sa.Column('parent_component_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('geometry_data', sa.JSON(), nullable=False),
    sa.Column('transformation_matrix', sa.JSON(), nullable=True),
    sa.Column('material_id', mysql.CHAR(length=36), nullable=True),
    sa.Column('volume', sa.Float(), nullable=True),
    sa.Column('surface_area', sa.Float(), nullable=True),
    sa.Column('mass', sa.Float(), nullable=True),
    sa.Column('color', sa.String(length=7), nullable=True),
    sa.Column('opacity', sa.Float(), nullable=True),
    sa.Column('is_visible', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['configuration_id'], ['regenerator_configurations.id'], ),
    sa.ForeignKeyConstraint(['material_id'], ['materials.id'], ),
    sa.ForeignKeyConstraint(['parent_component_id'], ['geometry_components.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('optimization_scenarios',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('user_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('scenario_type', sa.String(length=50), nullable=False),
    sa.Column('base_configuration_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('objective', sa.String(length=50), nullable=False),
    sa.Column('algorithm', sa.String(length=50), nullable=False),
    sa.Column('optimization_config', sa.JSON(), nullable=False),
    sa.Column('constraints_config', sa.JSON(), nullable=True),
    sa.Column('bounds_config', sa.JSON(), nullable=True),
    sa.Column('design_variables', sa.JSON(), nullable=False),
    sa.Column('objective_weights', sa.JSON(), nullable=True),
    sa.Column('max_iterations', sa.Integer(), nullable=True),
    sa.Column('max_function_evaluations', sa.Integer(), nullable=True),
    sa.Column('tolerance', sa.Float(), nullable=True),
    sa.Column('max_runtime_minutes', sa.Integer(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('is_template', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['base_configuration_id'], ['regenerator_configurations.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('optimization_jobs',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('scenario_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('user_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('job_name', sa.String(length=255), nullable=True),
    sa.Column('celery_task_id', sa.String(length=255), nullable=True),
    sa.Column('execution_config', sa.JSON(), nullable=False),
    sa.Column('initial_values', sa.JSON(), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('current_iteration', sa.Integer(), nullable=True),
    sa.Column('current_function_evaluations', sa.Integer(), nullable=True),
    sa.Column('progress_percentage', sa.Float(), nullable=True),
    sa.Column('started_at', sa.DateTime(), nullable=True),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.Column('estimated_completion_at', sa.DateTime(), nullable=True),
    sa.Column('runtime_seconds', sa.Float(), nullable=True),
    sa.Column('final_objective_value', sa.Float(), nullable=True),
    sa.Column('convergence_achieved', sa.Boolean(), nullable=True),
    sa.Column('convergence_criteria', sa.JSON(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('error_traceback', sa.Text(), nullable=True),
    sa.Column('warning_messages', sa.JSON(), nullable=True),
    sa.Column('memory_usage_mb', sa.Float(), nullable=True),
    sa.Column('cpu_usage_percentage', sa.Float(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['scenario_id'], ['optimization_scenarios.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('celery_task_id')
    )
    op.create_table('optimization_iterations',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('job_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('iteration_number', sa.Integer(), nullable=False),
    sa.Column('function_evaluation', sa.Integer(), nullable=False),
    sa.Column('design_variables', sa.JSON(), nullable=False),
    sa.Column('objective_value', sa.Float(), nullable=False),
    sa.Column('objective_components', sa.JSON(), nullable=True),
    sa.Column('constraint_values', sa.JSON(), nullable=True),
    sa.Column('constraint_violations', sa.JSON(), nullable=True),
    sa.Column('gradient', sa.JSON(), nullable=True),
    sa.Column('step_size', sa.Float(), nullable=True),
    sa.Column('convergence_metrics', sa.JSON(), nullable=True),
    sa.Column('performance_metrics', sa.JSON(), nullable=True),
    sa.Column('evaluation_time_seconds', sa.Float(), nullable=True),
    sa.Column('is_feasible', sa.Boolean(), nullable=True),
    sa.Column('is_improvement', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['job_id'], ['optimization_jobs.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('optimization_results',
    sa.Column('id', mysql.CHAR(length=36), nullable=False),
    sa.Column('job_id', mysql.CHAR(length=36), nullable=False),
    sa.Column('optimized_configuration', sa.JSON(), nullable=False),
    sa.Column('design_variables_final', sa.JSON(), nullable=False),
    sa.Column('objective_value', sa.Float(), nullable=False),
    sa.Column('objective_components', sa.JSON(), nullable=True),
    sa.Column('constraint_violations', sa.JSON(), nullable=True),
    sa.Column('baseline_metrics', sa.JSON(), nullable=False),
    sa.Column('optimized_metrics', sa.JSON(), nullable=False),
    sa.Column('improvement_percentages', sa.JSON(), nullable=False),
    sa.Column('fuel_savings_percentage', sa.Float(), nullable=True),
    sa.Column('co2_reduction_percentage', sa.Float(), nullable=True),
    sa.Column('annual_cost_savings', sa.Float(), nullable=True),
    sa.Column('payback_period_months', sa.Float(), nullable=True),
    sa.Column('thermal_efficiency', sa.Float(), nullable=True),
    sa.Column('pressure_drop', sa.Float(), nullable=True),
    sa.Column('heat_transfer_coefficient', sa.Float(), nullable=True),
    sa.Column('ntu_value', sa.Float(), nullable=True),
    sa.Column('optimized_geometry', sa.JSON(), nullable=True),
    sa.Column('volume_changes', sa.JSON(), nullable=True),
    sa.Column('surface_area_changes', sa.JSON(), nullable=True),
    sa.Column('material_recommendations', sa.JSON(), nullable=True),
    sa.Column('material_cost_impact', sa.JSON(), nullable=True),
    sa.Column('sensitivity_analysis', sa.JSON(), nullable=True),
    sa.Column('robustness_metrics', sa.JSON(), nullable=True),
    sa.Column('solution_feasibility', sa.Float(), nullable=True),
    sa.Column('optimization_confidence', sa.Float(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['job_id'], ['optimization_jobs.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('users', schema=None) as batch_op:
        batch_op.alter_column('created_at',
               existing_type=mysql.DATETIME(),
               server_default=sa.text('now()'),
               existing_nullable=False)
        batch_op.alter_column('updated_at',
               existing_type=mysql.DATETIME(),
               server_default=sa.text('now()'),
               existing_nullable=False)

    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade database schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('users', schema=None) as batch_op:
        batch_op.alter_column('updated_at',
               existing_type=mysql.DATETIME(),
               server_default=sa.text('CURRENT_TIMESTAMP'),
               existing_nullable=False)
        batch_op.alter_column('created_at',
               existing_type=mysql.DATETIME(),
               server_default=sa.text('CURRENT_TIMESTAMP'),
               existing_nullable=False)

    op.drop_table('optimization_results')
    op.drop_table('optimization_iterations')
    op.drop_table('optimization_jobs')
    op.drop_table('optimization_scenarios')
    op.drop_table('geometry_components')
    op.drop_table('configuration_history')
    op.drop_table('report_schedules')
    op.drop_table('report_exports')
    op.drop_table('report_data')
    op.drop_table('regenerator_configurations')
    op.drop_table('imported_regenerators')
    op.drop_table('reports')
    op.drop_table('report_templates')
    op.drop_table('optimization_templates')
    op.drop_table('materials')
    op.drop_table('import_jobs')
    op.drop_table('configuration_templates')
    op.drop_table('validation_rules')
    op.drop_table('unit_conversions')
    op.drop_table('system_metrics')
    op.drop_table('configuration_constraints')
    # ### end Alembic commands ###