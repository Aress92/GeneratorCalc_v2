FROM node:18-alpine

# Metadata
LABEL maintainer="Forglass Engineering Team <engineering@forglass.com>"
LABEL description="Development container for Forglass Regenerator Optimizer Frontend"

# Set working directory
WORKDIR /app

# Install pnpm globally
RUN npm install -g pnpm@8.15.0

# Create app user early
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nextjs -u 1001

# Copy package files
COPY --chown=nextjs:nodejs package.json pnpm-lock.yaml* ./

# Install dependencies
RUN pnpm install --frozen-lockfile=false

# Copy application code (node_modules excluded via .dockerignore)
COPY --chown=nextjs:nodejs . .

# Create .next directory with proper permissions
RUN mkdir -p .next && chown -R nextjs:nodejs /app

# Switch to app user
USER nextjs

# Expose port
EXPOSE 3000

# Set environment variables
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1

# Development command with hot reload
CMD ["pnpm", "dev"]